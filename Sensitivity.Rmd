---
title: "R Sensitivity Analysis for casino floor optimization"
output: html_notebook
---

```{r}
# load r object with the solutions for each month
load("solutions.RData")
```


#Sensitivity Analysis
Nel risolvere un problema di PL si assume che i coefficienti siano conosciuti con certezza, ma nella realtà questa certezza quasi mai esiste. La Sensitivity Analysis è la fase post modellazione che permette di valutare la bontà del modello creato, ovvero quanto la soluzione ottimale è sensibile a variazioni dei coefficienti del modello (vincoli e F.O.).  
A titolo d'esempio, verrà effettuata la SA solo per la soluzione del mese di settembre: è chiaro che sia possibile replicare il lavoro per i mesi successivi effettuando i dovuti accorgimenti. 

Vincolo 1 
```{r}
sol <- sols$`2011-09-01`
shadow_price <- sol$con
vincolo1 <- shadow_price[1:2,]
knitr::kable(vincolo1) 
```
Osservazioni:   
- Ciascun vincolo è pienamente soddisfatto, ergo il numero di macchine totali per Aries e Libra resta quello della configurazione iniziale;    
- Volendo aumentare la disponibilità di macchine per uno dei due Casinò dovremmo guardare il valore dei prezzi ombra (dual) e la regione (dual.reg) dove tali valori sono validi.  
Si nota che per ogni macchina addizionale allocata ad Aries la Funzione Obiettivo aumenta di euro 8797 (dual) e che l'incremento massimo consentito è di 47 macchine. Per Libra invece ogni macchina addizionale consente alla Funzione Obiettivo di aumentare il suo valore per euro 15918,ma l'incremento massimo consentito è nettamente minore (7 macchine). Potendo scegliere di incrementare la disponibilità di macchine per uno solo dei 2 Casinò, LDE dovrebbe comportarsi in maniera differente a seconda del numero di macchine a disposizione:
- numero di macchine <= 8, la priorità dovrebbe essere data a Libra in quanto capace di generare l'incremento maggiore;  
- 15 <= numero di macchine <= 47, la priorità dovrebbe essere data ad Aries in quanto capace di generare l'incremento maggiore;  
- 8 < numero di macchine < 15, questo intervallo è valido solamente per Aries, tuttavia l'incremento totale generato sarebbe comunque inferiore a quello prodotto da Libra con 8 macchine, quindi si preferisce ancora una volta Libra.  
Questione di equazioni: $$ 15918 * 8 = 8797x$$


Vincolo 2
Si ricorda che ciascun vincolo è stato "sdoppiato" in quanto necessario sia l'upper che il lower bound.
```{r}
vincolo2 <- shadow_price[3:18,]
knitr::kable(vincolo2) 
```


Let's look the upper bound to know which section have the maximum number of machines.  
Only constraints n. 14 n. 16 are binding, this means:  
- In Aries the Section that receives more machines (0.18 of the total) is "Restaurant Plaza" (constraint 7);  
- In Libra the Section that recerives more machines (0.35 of the total) is "Interior" (constraint 6).  

Let's look the lower bound to know which section have the minimum number of machines.  
In this case constraints n. 5,7,9 received the minimun number of machines: the number of machines is just sufficient to cover the lower bound, this means:  
- In Aries one Section, Entrace, receives less machines that the other ones;  
- In Libra two Sections, Boundary and Entrance, receive less machines that the other ones.  

Also in this case we can see the dual (shadow price) and dual.reg to decide which section could have more machines.

Last one: Number of machines of each category in each section
We remind that each constraint has lower and upper bound.
```{r}
vincolo3 <- shadow_price[19:length(shadow_price[,1]),]
rownames(vincolo3) <- 1:length(vincolo3[,1])
knitr::kable(head(vincolo3))
```

Let's look the upper bound to know which category in each section have the maximum number of machines.
```{r}
knitr::kable(vincolo3[vincolo3$actual == vincolo3$bvec & vincolo3$dir == "<=", ])
```
Ok queste sono le categorie che in ogni sezione hanno ricevuto il numero massimo di macchine: riesci a farmi una funzioncina che mi riconduca alle macchine del dataframe di partenza? Forse ti conviene usare il dataframe che ho costruito prima "vincolo 3" che contiene solamente le informazioni relative al terzo vincolo (upper e lower bound). Ho riordinato le righe da 1 a 156 con rownames pensando servisse. 

...Second Part...
```{r}
knitr::kable(sol$allvar)
```
